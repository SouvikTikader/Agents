<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Predict Academic Risk | Smart Academic System</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    body {
      background: linear-gradient(to right, #e3f2fd, #f1f8ff);
      font-family: 'Poppins', sans-serif;
    }
    .hero {
      background: #0d6efd;
      color: white;
      padding: 2rem 1rem;
      border-radius: 1rem;
      text-align: center;
      margin-bottom: 2rem;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .card-hover {
      transition: all 0.3s ease;
    }
    .card-hover:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }
    .action-card {
      cursor: pointer;
      text-align: center;
      padding: 1.5rem;
      border-radius: 1rem;
      transition: 0.3s;
    }
    .action-card:hover {
      background: #f0f8ff;
      transform: translateY(-4px);
    }
    .info-text {
      font-size: 0.95rem;
      color: #555;
      line-height: 1.6;
    }
  </style>
</head>
<body>

<!-- MODERN NAVBAR -->
<nav class="navbar navbar-expand-lg shadow-sm fixed-top" 
     style="backdrop-filter: blur(10px); background: #0d6efd; border-bottom: 1px solid rgba(255,255,255,0.2);">
  <div class="container-fluid px-4">
    
    <!-- Brand -->
    <a class="navbar-brand d-flex align-items-center text-white fw-bold" href="/" style="font-size: 1.25rem;">
      <i class="bi bi-mortarboard-fill me-2"></i> Smart Academic System
    </a>

    <div class="d-flex align-items-center ms-auto gap-2">

      <!-- Notifications Dropdown -->
      <!-- Simple Notifications Link -->
      <a href="/notifications" class="btn btn-light btn-sm rounded-circle border-0 shadow-sm me-2" 
        style="width: 38px; height: 38px; display: flex; align-items: center; justify-content: center;">
        <i class="bi bi-bell-fill text-primary"></i>
      </a>

      <!-- 3-Bar Menu -->
      <div class="dropdown">
        <button class="btn btn-light btn-sm rounded-circle border-0 shadow-sm" type="button" id="menuDropdown" data-bs-toggle="dropdown"
                style="width: 38px; height: 38px; display: flex; align-items: center; justify-content: center;">
          <i class="bi bi-list text-primary fs-5"></i>
        </button>
        <ul class="dropdown-menu dropdown-menu-end shadow-lg border-0 rounded-3" aria-labelledby="menuDropdown">
          <li class="dropdown-header fw-semibold text-muted small px-3"><i class="bi bi-person-circle me-1"></i> {{ username }}</li>
          <li><a class="dropdown-item" href="/dashboard"><i class="bi bi-house me-2 text-primary"></i>Dashboard</a></li>
          <li><a class="dropdown-item" href="/griev"><i class="bi bi-exclamation-diamond me-2 text-danger"></i>Submit Grievance</a></li>
          
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item text-danger fw-semibold" href="/logout"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
        </ul>
      </div>
    </div>
  </div>
</nav>

<!-- Add padding for fixed-top -->
<div style="height: 70px;"></div>


<!-- HERO SECTION -->
<div class="container my-4">
  <div class="hero">
    <h2><i class="bi bi-graph-up-arrow me-2"></i> Predict Your Academic Risk</h2>
    <p class="mt-2 mb-0">Get instant insights about your academic performance and personalized suggestions to improve.</p>
  </div>

  <!-- Info Section -->
  <div class="card border-0 shadow-sm mb-4 p-4 card-hover">
    <h5 class="text-primary"><i class="bi bi-lightbulb"></i> How It Works</h5>
    <p class="info-text mt-2">
      This tool helps you assess your academic risk level based on your attendance, TA scores, and final marks. 
      It compares your performance with dynamically calculated thresholds and provides actionable suggestions 
      for improvement. The goal is to identify risk early and help you stay on track.
    </p>
  </div>

  <!-- FORM -->
  <div class="card shadow-sm border-0 p-4 mx-auto card-hover" style="max-width: 600px;">
    <h4 class="mb-3 text-center text-primary"><i class="bi bi-bar-chart-line"></i> Enter Your Details</h4>
    <form action="/predict_risk" method="POST">
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">Attendance (%)</label>
          <input type="number" step="0.1" name="attendance" class="form-control" required>
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label">TA1 Marks</label>
          <input type="number" step="0.1" name="ta1_marks" class="form-control" required>
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label">TA2 Marks</label>
          <input type="number" step="0.1" name="ta2_marks" class="form-control" required>
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label">Final Exam Marks</label>
          <input type="number" step="0.1" name="final_marks" class="form-control" required>
        </div>
        <div class="col-md-12 mb-3">
          <label class="form-label">Assignment Marks</label>
          <input type="number" step="0.1" name="assignment_marks" class="form-control" required>
        </div>
      </div>
      <button class="btn btn-primary w-100 mt-2"><i class="bi bi-search"></i> Predict Risk</button>
    </form>

    {% if risk_summary %}
    <div class="card mt-4 shadow-sm p-3 border-0">
      <h5 class="text-center text-primary"><i class="bi bi-activity"></i> Risk Summary</h5>
      <table class="table table-striped mt-3">
        <thead class="table-light">
          <tr>
            <th>Component</th>
            <th>Actual</th>
            <th>Threshold</th>
            <th>Status</th>
            <th>Suggestion</th>
          </tr>
        </thead>
        <tbody>
          {% for r in risk_summary %}
          <tr>
            <td>{{ r.component }}</td>
            <td>{{ r.actual }}</td>
            <td>{{ r.threshold|round(1) }}</td>
            <td class="{% if r.status == 'At Risk' %}text-danger fw-bold{% else %}text-success{% endif %}">{{ r.status }}</td>
            <td>{{ r.suggestion }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% endif %}
  </div>
  <!-- Add after the risk summary -->
  <div id="aiPredictions" class="card mt-4">
    <div class="card-header bg-info text-white">
      <h6><i class="bi bi-robot"></i> AI Agent Predictions</h6>
    </div>
    <div class="card-body">
      <div id="predictionContent">
        <!-- AI predictions will load here -->
      </div>
    </div>
  </div>

    

  <!-- Quick Actions -->
  <div class="row justify-content-center text-center mt-5">
    <div class="col-md-4 col-sm-6 mb-3">
      <div class="action-card shadow-sm p-4 rounded-3" onclick="window.location='/dashboard'" style="cursor:pointer;">
        <i class="bi bi-house display-5 text-primary"></i>
        <h6 class="mt-2 fw-semibold">Go to Dashboard</h6>
      </div>
    </div>
    
    <div class="col-md-4 col-sm-6 mb-3">
      <div class="action-card shadow-sm p-4 rounded-3" onclick="window.location='/griev'" style="cursor:pointer;">
        <i class="bi bi-chat-dots display-5 text-success"></i>
        <h6 class="mt-2 fw-semibold">Submit a Grievance</h6>
      </div>
    </div>
  </div>

</div>
<script>
// Load AI predictions based on entered data
function loadAIPredictions(formData) {
  fetch('/api/ai-predictions', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(formData)
  })
  .then(r => r.json())
  .then(predictions => {
    document.getElementById('predictionContent').innerHTML = `
      <p><strong>Predicted Final Grade:</strong> ${predictions.predicted_grade}%</p>
      <p><strong>Risk Level:</strong> <span class="badge ${predictions.risk_level === 'High' ? 'bg-danger' : predictions.risk_level === 'Medium' ? 'bg-warning' : 'bg-success'}">${predictions.risk_level}</span></p>
      <p><strong>Recommended Focus Areas:</strong> ${predictions.recommendations.join(', ')}</p>
    `;
  });
}
</script>

</body>
</html>
